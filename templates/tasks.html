<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>TaskScore ‚Äì Aufgaben</title>
  <style>
    body{
        font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;margin:0;padding:0;background:#f4f5f7}
    header{
        background:#1f2933;color:#fff;padding:16px 24px}
    header h1{
        margin:0;font-size:1.6rem}
    main{
        max-width:900px;margin:24px auto;padding:0 16px 32px}
    .card{
        background:hsl(173, 35%, 82%);border-radius:12px;padding:20px 24px;box-shadow:0 2px 6px rgba(0,0,0,.08);margin:0 0 16px}
    .nav a{
        display:inline-block;margin-right:5px;text-decoration:none;color:#2c64d5;font-weight:500;padding:8px 14px;border:2px solid #000000;border-radius:10px;transition:0.2s;background:white}
    .nav a:hover {
      background:#2563eb;color:white;}
    .muted{
        color:#000000;font-size:.9rem}
    label{
        display:block;font-size:.9rem;margin-top:10px}
    input,select,textarea{
        width:100%;box-sizing:border-box;padding:10px;border-radius:10px;border:1px solid #d1d5db;margin-top:6px;font-size:.95rem;background:#fff}
    textarea{
      min-height:90px;resize:vertical}
    button{
        display:inline-block;margin-top:5px;margin-right:5px;text-decoration:none;color:#2c64d5;font-weight:500;padding:8px 14px;border:2px solid #000000;border-radius:10px;background:white;cursor:pointer;transition:0.2s;font-family:inherit;font-size:0.95rem;line-height:1.2;}
    button:hover {
      background:#2563eb;color:white;
    }
    table{
        width:100%;border-collapse:collapse;margin-top:10px}
    th,td{
        text-align:left;padding:10px 8px;border-bottom:1px solid #e5e7eb;vertical-align:top}
    th{
        font-size:.85rem;color:#374151}
    .alert-error{
        margin-bottom:12px;padding:10px 14px;background:#fee2e2;color:#991b1b;border-radius:10px;font-size:.9rem}
    .btn-pill{
        margin-top:0;padding:4px 10px;font-size:.8rem;border-radius:999px;border:0;cursor:pointer}
    .status-done{
        background:#00b03e;color:#ffffff}
    .status-open{
        background:#f90000;color:#ffffff}
    .btn-delete{
        background:#ffffff;color:#000000}

    .multi-dd{
        position:relative;margin-top:6px;
    }
    .multi-dd-btn{
        width:100%;box-sizing:border-box;padding:10px;border-radius:10px;border:1px solid #d1d5db;background:#fff;text-align:left;cursor:pointer;font-family:inherit;font-size:.95rem;line-height:1.2;color:#111827;
    }
    .multi-dd-menu{
        display:none;position:absolute;left:0;right:0;top:calc(100% + 6px);background:#fff;border:1px solid #d1d5db;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.12);padding:10px;z-index:50;max-height:240px;overflow:auto;
    }
    .multi-dd-menu label{
        display:flex;align-items:center;gap:8px;padding:6px 6px;cursor:pointer;margin-top:0;font-size:.95rem;color:#111827;border-radius:8px;
    }
    .multi-dd-menu label:hover{
        background:#f3f4f6;
    }
    .multi-dd-menu input[type="checkbox"]{
        width:auto;margin:0;
    }
  </style>
</head>

<body>
  <header>
    <h1>TaskScore ‚Äì Aufgaben</h1>
  </header>

  <main>
    <section class="card nav">
      <h2>Navigation üß≠</h2>
      <a href="/">Hauptmen√º</a>
      <a href="/plan">Wochenplan ansehen</a>
      <a href="/progress">Fortschritt anzeigen</a>
    </section>

    <section class="card">
      <h2>Neue Aufgabe anlegen</h2>

      <p class="h2"><u><i><strong>{{ current_total }}/ {{ budget }} Punkte verwendet</strong> </i> </u></p>
      <p class="label"><strong>Kleiner Tipp üí≠: Rechne mit maximal 14-15 Punkten pro Tag.</strong></p>

      {% if error %}
        <div class="alert-error">{{ error }}</div>
      {% endif %}

      <form method="post" action="/tasks">
        <label>Titel ‚öíÔ∏è</label>
        <input name="title" required>

        <label>Beschreibung ‚úíÔ∏è</label>
        <textarea name="description"></textarea>

        <label>Wochentage üóìÔ∏è</label>

        <div class="multi-dd" id="weekdayDD">
          <button type="button" class="multi-dd-btn" id="weekdayBtn">Tage ausw√§hlen‚Ä¶</button>

          <div class="multi-dd-menu" id="weekdayMenu">
            <label><input type="checkbox" value="Montag üíº"> Montag üíº</label>
            <label><input type="checkbox" value="Dienstag üìä"> Dienstag üìä</label>
            <label><input type="checkbox" value="Mittwoch ‚è≥"> Mittwoch ‚è≥</label>
            <label><input type="checkbox" value="Donnerstag üéØ"> Donnerstag üéØ</label>
            <label><input type="checkbox" value="Freitag üèÅ"> Freitag üèÅ</label>
            <label><input type="checkbox" value="Samstag üï∫"> Samstag üï∫</label>
            <label><input type="checkbox" value="Sonntag üåø"> Sonntag üåø</label>
          </div>

          <input type="hidden" name="weekdays" id="weekdaysHidden">
        </div>

        <label>Punkteüí∞</label>
        <input type="number" name="points_total" value="0" min="0">

        <button type="submit">Aufgabe hinzuf√ºgen</button>
      </form>
    </section>

    <section class="card">
      <h2>Geplante Aufgaben</h2>

      {% if tasks %}
        <table>
          <thead>
            <tr>
              <th>Titel</th><th>Tag</th><th>Punkte</th><th>Status</th><th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tasks %}
              <tr>
                <td>
                  <strong>{{ t.title }}</strong><br>
                  <span class="muted">{{ t.description }}</span>
                </td>
                <td>{{ t.weekday }}</td>
                <td>{{ t.points_total }}</td>

                <td>
                  <form method="post" action="/tasks/{{ t.id }}/toggle">
                    <button type="submit"
                      class="btn-pill {% if t.status == 'DONE' %}status-done{% else %}status-open{% endif %}">
                      {{ t.status }}
                    </button>
                  </form>
                </td>

                <td>
                  <form method="post" action="/tasks/{{ t.id }}/delete">
                    <button type="submit" class="btn-pill btn-delete">L√∂schen</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">Noch keine Aufgaben vorhanden.</p>
      {% endif %}
    </section>
  </main>

  <script>
    const dd = document.getElementById("weekdayDD");
    const btn = document.getElementById("weekdayBtn");
    const menu = document.getElementById("weekdayMenu");
    const hidden = document.getElementById("weekdaysHidden");
    const checks = menu.querySelectorAll("input[type=checkbox]");

    function updateLabel(){
      const selected = Array.from(checks).filter(c => c.checked).map(c => c.value);
      hidden.value = selected.join(",");  // wichtig: Komma!
      btn.textContent = selected.length ? selected.join(", ") : "Tage ausw√§hlen‚Ä¶";
    }

    btn.addEventListener("click", () => {
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    });

    checks.forEach(c => c.addEventListener("change", updateLabel));

    document.addEventListener("click", (e) => {
      if (!dd.contains(e.target)) menu.style.display = "none";
    });

    updateLabel();
  </script>
</body>
</html>